"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function displayValue(e,t){if(!t)return"";switch(e.type){case"location":return t.district+", "+t.municipality+", "+t.village;default:return t.toString()}}function fetchDataSource(e){if(!e)return{type:"loadDataSource",dataSource:e,data:null};var t=function(){var t=DataSources[e];return{v:function(a){return fetch(t.url).then(function(e){return e.json()}).then(function(t){var n=_.sortBy(t,"date");a({type:"loadDataSource",dataSource:e,data:n})})}}}();return"object"===("undefined"==typeof t?"undefined":_typeof(t))?t.v:void 0}function fetchCities(){return function(e){return fetch("/data/cities.json").then(function(e){return e.json()}).then(function(t){e({type:"loadCities",data:_.sortBy(t,_.identity)})})}}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),DataSources={cchf:{label:"CCHF",url:"/data/cchf.json",fields:[{name:"date",label:"Date of onset",type:"date"},{name:"location",label:"Location",type:"location"},{name:"age",label:"Age",type:"number"},{name:"gender",label:"Gender",type:"enumeration"},{name:"case_contact",label:"Case type",type:"enumeration"},{name:"date_hospitalization_district",label:"Date of hospitalization in district",type:"date"},{name:"date_hospitalization_central",label:"Date of hospitalization in central",type:"date"},{name:"district_reporting_date",label:"Date of reporting for district",type:"date"},{name:"iph_reporting_date",label:"Date of reporting for IPH",type:"date"},{name:"patient_status",label:"Patient status",type:"enumeration"},{name:"epi_investigation_date",label:"EPI investigation",type:"date"}]},brucellosis:{label:"Brucellosis",url:"/data/brucellosis.json",fields:[{name:"date",label:"Date of onset",type:"date"},{name:"location",label:"Location",type:"location"},{name:"age",label:"Age",type:"number"},{name:"gender",label:"Gender",type:"enumeration"},{name:"case_contact",label:"Case type",type:"enumeration"},{name:"date_hospitalization_district",label:"Date of hospitalization in district",type:"date"},{name:"date_hospitalization_central",label:"Date of hospitalization in central",type:"date"}]},hbv_hbc:{label:"HBV and HCV",fields:[]}},createStore=Redux.createStore,applyMiddleware=Redux.applyMiddleware,Provider=ReactRedux.Provider,connect=ReactRedux.connect,thunk=ReduxThunk["default"],DataSourceSection=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"handleSelect",value:function(e){this.props.onSelected(e&&e.value)}},{key:"render",value:function(){var e=_.map(DataSources,function(e,t){return{value:t,label:e.label}});return React.createElement("div",{className:""},React.createElement("label",null,"Data Source"),React.createElement(Select,{value:this.props.dataSource,onChange:this.handleSelect.bind(this),options:e}))}}]),t}(React.Component),DataSourceSectionState=function(e){return{dataSource:e.dataSource}},DataSourceSectionDispatch=function(e){return{onSelected:function(t){e(fetchDataSource(t))}}};DataSourceSection=connect(DataSourceSectionState,DataSourceSectionDispatch)(DataSourceSection);var LocationSection=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"handleSelect",value:function(e){this.props.onSelected(e&&e.value)}},{key:"render",value:function(){var e=_.map(this.props.locations,function(e,t){return{value:t,label:e}});return React.createElement("div",{className:""},React.createElement("label",null,"Location"),React.createElement(Select,{value:this.props.location,onChange:this.handleSelect.bind(this),options:e}))}}]),t}(React.Component),LocationSectionState=function(e){return{location:e.location,locations:e.locations}},LocationSectionDispatch=function(e){return{onSelected:function(t){e({type:"selectLocation",location:t})}}};LocationSection=connect(LocationSectionState,LocationSectionDispatch)(LocationSection);var TimePeriodSection=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:""},React.createElement("label",null,"Time Period"),React.createElement("input",{type:"date",className:"form-control"}),React.createElement("input",{type:"date",className:"form-control"}))}}]),t}(React.Component),FilterRow=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"row form-inline filter-row"},React.createElement("label",null,"Filter #",this.props.name),React.createElement("input",{className:"form-control"}),React.createElement("button",{className:"btn btn-danger",onClick:this.props.onRemove},"Remove filter"))}}]),t}(React.Component),FiltersPanel=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"handleNewFilter",value:function(){this.props.addFilter()}},{key:"handleRemoveFilter",value:function(e){this.props.removeFilter(e)}},{key:"render",value:function(){var e=_.map(this.props.filters,function(e,t){return React.createElement(FilterRow,{key:t,name:e,onRemove:this.handleRemoveFilter.bind(this,t)})}.bind(this));return React.createElement("div",{className:""},React.createElement("fieldset",null,React.createElement("legend",null,"Filters"),e,React.createElement("div",{className:"row"},React.createElement("button",{className:"btn btn-primary",onClick:this.handleNewFilter.bind(this)},"Add filter"))))}}]),t}(React.Component),FiltersPanelState=function(e){return{filters:e.filters}},FiltersPanelDispatch=function(e){return{addFilter:function(){e({type:"addFilter"})},removeFilter:function(t){e({type:"removeFilter",index:t})}}};FiltersPanel=connect(FiltersPanelState,FiltersPanelDispatch)(FiltersPanel);var FilterTableRow=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=void 0;return e=_.map(this.props.fields,function(e){var t=this.props.data[e.name];return t=displayValue(e,t),React.createElement("td",{key:e.name},t)}.bind(this)),React.createElement("tr",null,e)}}]),t}(React.Component),FilterTable=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this,t=void 0,a=void 0;return this.props.rows&&!function(){var n=e.props.dataSource.fields;t=_.map(e.props.rows,function(e,t){return React.createElement(FilterTableRow,{data:e,fields:n,key:t})}),a=_.map(n,function(e){return React.createElement("th",{key:e.name},e.label)})}(),React.createElement("div",{className:"col-md-12"},React.createElement("table",{className:"table filter-results"},React.createElement("thead",null,React.createElement("tr",null,a)),React.createElement("tbody",null,t)))}}]),t}(React.Component),FilterTableState=function(e){return{rows:e.currentData,dataSource:DataSources[e.dataSource]}};FilterTable=connect(FilterTableState)(FilterTable);var QueryPanel=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=void 0,t=void 0;return this.props.hasDataSource&&(e=React.createElement(FiltersPanel,null),this.props.hasData&&(t=React.createElement(FilterTable,null))),React.createElement("div",null,React.createElement("div",{className:"row"},React.createElement(TimePeriodSection,null),React.createElement(LocationSection,null),React.createElement(DataSourceSection,null)),e,t)}}]),t}(React.Component),QueryPanelState=function(e){return{hasDataSource:null!=e.dataSource,hasData:null!=e.currentData}};QueryPanel=connect(QueryPanelState)(QueryPanel);var initialState={periodStart:null,periodEnd:null,location:null,locations:[],dataSource:null,filters:[1,2],aggregations:[],nextFilterId:3,currentData:null},reducer=function(e,t){if(void 0===e)return initialState;var a=e,n=void 0;switch(t.type){case"selectLocation":a=Object.assign({},e,{location:t.location});break;case"selectDataSource":a=Object.assign({},e,{dataSource:t.dataSource});break;case"addFilter":var r=e.nextFilterId;n=e.filters.concat([r]),a=Object.assign({},e,{filters:n,nextFilterId:r+1});break;case"removeFilter":n=e.filters.concat([]),n.splice(t.index,1),a=Object.assign({},e,{filters:n});break;case"loadDataSource":a=Object.assign({},e,{dataSource:t.dataSource,currentData:t.data});break;case"loadCities":a=Object.assign({},e,{locations:t.data})}return a},store=createStore(reducer,applyMiddleware(thunk));store.dispatch(fetchDataSource("cchf")),store.dispatch(fetchCities()),ReactDOM.render(React.createElement(Provider,{store:store},React.createElement(QueryPanel,null)),document.getElementById("app"));